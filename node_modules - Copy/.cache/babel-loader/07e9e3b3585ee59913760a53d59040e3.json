{"ast":null,"code":"\"use strict\";\n\nexports.__esModule = true;\nvar _extends = Object.assign || function (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      if (Object.prototype.hasOwnProperty.call(source, key)) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n};\nvar _react = require(\"react\");\nvar _react2 = _interopRequireDefault(_react);\nrequire(\"../style/MouseSelection.css\");\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\nvar MouseSelection = function (_Component) {\n  _inherits(MouseSelection, _Component);\n  function MouseSelection() {\n    var _temp, _this, _ret;\n    _classCallCheck(this, MouseSelection);\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, _Component.call.apply(_Component, [this].concat(args))), _this), _this.state = {\n      locked: false,\n      start: null,\n      end: null\n    }, _this.reset = function () {\n      var onDragEnd = _this.props.onDragEnd;\n      onDragEnd();\n      _this.setState({\n        start: null,\n        end: null,\n        locked: false\n      });\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n  MouseSelection.prototype.getBoundingRect = function getBoundingRect(start, end) {\n    return {\n      left: Math.min(end.x, start.x),\n      top: Math.min(end.y, start.y),\n      width: Math.abs(end.x - start.x),\n      height: Math.abs(end.y - start.y)\n    };\n  };\n  MouseSelection.prototype.componentDidUpdate = function componentDidUpdate() {\n    var onChange = this.props.onChange;\n    var _state = this.state,\n      start = _state.start,\n      end = _state.end;\n    var isVisible = Boolean(start && end);\n    onChange(isVisible);\n  };\n  MouseSelection.prototype.componentDidMount = function componentDidMount() {\n    var _this2 = this;\n    if (!this.root) {\n      return;\n    }\n    var that = this;\n    var _props = this.props,\n      onSelection = _props.onSelection,\n      onDragStart = _props.onDragStart,\n      onDragEnd = _props.onDragEnd,\n      shouldStart = _props.shouldStart;\n    var container = this.root.parentElement;\n    if (!(container instanceof HTMLElement)) {\n      return;\n    }\n    var containerBoundingRect = null;\n    var containerCoords = function containerCoords(pageX, pageY) {\n      if (!containerBoundingRect) {\n        containerBoundingRect = container.getBoundingClientRect();\n      }\n      return {\n        x: pageX - containerBoundingRect.left + container.scrollLeft,\n        y: pageY - containerBoundingRect.top + container.scrollTop\n      };\n    };\n    container.addEventListener(\"mousemove\", function (event) {\n      var _state2 = _this2.state,\n        start = _state2.start,\n        locked = _state2.locked;\n      if (!start || locked) {\n        return;\n      }\n      that.setState(_extends({}, _this2.state, {\n        end: containerCoords(event.pageX, event.pageY)\n      }));\n    });\n    container.addEventListener(\"mousedown\", function (event) {\n      if (!shouldStart(event)) {\n        _this2.reset();\n        return;\n      }\n      var startTarget = event.target;\n      if (!(startTarget instanceof HTMLElement)) {\n        return;\n      }\n      onDragStart();\n      _this2.setState({\n        start: containerCoords(event.pageX, event.pageY),\n        end: null,\n        locked: false\n      });\n      var onMouseUp = function onMouseUp(event) {\n        // emulate listen once\n        event.currentTarget.removeEventListener(\"mouseup\", onMouseUp);\n        var start = _this2.state.start;\n        if (!start) {\n          return;\n        }\n        var end = containerCoords(event.pageX, event.pageY);\n        var boundingRect = that.getBoundingRect(start, end);\n        if (!(event.target instanceof HTMLElement) || !container.contains(event.target) || !that.shouldRender(boundingRect)) {\n          that.reset();\n          return;\n        }\n        that.setState({\n          end: end,\n          locked: true\n        }, function () {\n          var _that$state = that.state,\n            start = _that$state.start,\n            end = _that$state.end;\n          if (!start || !end) {\n            return;\n          }\n          if (event.target instanceof HTMLElement) {\n            onSelection(startTarget, boundingRect, that.reset);\n            onDragEnd();\n          }\n        });\n      };\n      if (document.body) {\n        document.body.addEventListener(\"mouseup\", onMouseUp);\n      }\n    });\n  };\n  MouseSelection.prototype.shouldRender = function shouldRender(boundingRect) {\n    return boundingRect.width >= 1 && boundingRect.height >= 1;\n  };\n  MouseSelection.prototype.render = function render() {\n    var _this3 = this;\n    var _state3 = this.state,\n      start = _state3.start,\n      end = _state3.end;\n    return _react2.default.createElement(\"div\", {\n      className: \"MouseSelection-container\",\n      ref: function ref(node) {\n        return _this3.root = node;\n      }\n    }, start && end ? _react2.default.createElement(\"div\", {\n      className: \"MouseSelection\",\n      style: this.getBoundingRect(start, end)\n    }) : null);\n  };\n  return MouseSelection;\n}(_react.Component);\nexports.default = MouseSelection;\nmodule.exports = exports[\"default\"];","map":null,"metadata":{},"sourceType":"script"}