{"ast":null,"code":"var _ = require(\"underscore\");\nvar docxReader = require(\"./docx/docx-reader\");\nvar docxStyleMap = require(\"./docx/style-map\");\nvar DocumentConverter = require(\"./document-to-html\").DocumentConverter;\nvar readStyle = require(\"./style-reader\").readStyle;\nvar readOptions = require(\"./options-reader\").readOptions;\nvar unzip = require(\"./unzip\");\nvar Result = require(\"./results\").Result;\nexports.convertToHtml = convertToHtml;\nexports.convertToMarkdown = convertToMarkdown;\nexports.convert = convert;\nexports.extractRawText = extractRawText;\nexports.images = require(\"./images\");\nexports.transforms = require(\"./transforms\");\nexports.underline = require(\"./underline\");\nexports.embedStyleMap = embedStyleMap;\nexports.readEmbeddedStyleMap = readEmbeddedStyleMap;\nfunction convertToHtml(input, options) {\n  return convert(input, options);\n}\nfunction convertToMarkdown(input, options) {\n  var markdownOptions = Object.create(options || {});\n  markdownOptions.outputFormat = \"markdown\";\n  return convert(input, markdownOptions);\n}\nfunction convert(input, options) {\n  options = readOptions(options);\n  return unzip.openZip(input).tap(function (docxFile) {\n    return docxStyleMap.readStyleMap(docxFile).then(function (styleMap) {\n      options.embeddedStyleMap = styleMap;\n    });\n  }).then(function (docxFile) {\n    return docxReader.read(docxFile, input).then(function (documentResult) {\n      return documentResult.map(options.transformDocument);\n    }).then(function (documentResult) {\n      return convertDocumentToHtml(documentResult, options);\n    });\n  });\n}\nfunction readEmbeddedStyleMap(input) {\n  return unzip.openZip(input).then(docxStyleMap.readStyleMap);\n}\nfunction convertDocumentToHtml(documentResult, options) {\n  var styleMapResult = parseStyleMap(options.readStyleMap());\n  var parsedOptions = _.extend({}, options, {\n    styleMap: styleMapResult.value\n  });\n  var documentConverter = new DocumentConverter(parsedOptions);\n  return documentResult.flatMapThen(function (document) {\n    return styleMapResult.flatMapThen(function (styleMap) {\n      return documentConverter.convertToHtml(document);\n    });\n  });\n}\nfunction parseStyleMap(styleMap) {\n  return Result.combine((styleMap || []).map(readStyle)).map(function (styleMap) {\n    return styleMap.filter(function (styleMapping) {\n      return !!styleMapping;\n    });\n  });\n}\nfunction extractRawText(input) {\n  return unzip.openZip(input).then(docxReader.read).then(function (documentResult) {\n    return documentResult.map(convertElementToRawText);\n  });\n}\nfunction convertElementToRawText(element) {\n  if (element.type === \"text\") {\n    return element.value;\n  } else {\n    var tail = element.type === \"paragraph\" ? \"\\n\\n\" : \"\";\n    return (element.children || []).map(convertElementToRawText).join(\"\") + tail;\n  }\n}\nfunction embedStyleMap(input, styleMap) {\n  return unzip.openZip(input).tap(function (docxFile) {\n    return docxStyleMap.writeStyleMap(docxFile, styleMap);\n  }).then(function (docxFile) {\n    return {\n      toBuffer: docxFile.toBuffer\n    };\n  });\n}\nexports.styleMapping = function () {\n  throw new Error('Use a raw string instead of mammoth.styleMapping e.g. \"p[style-name=\\'Title\\'] => h1\" instead of mammoth.styleMapping(\"p[style-name=\\'Title\\'] => h1\")');\n};","map":null,"metadata":{},"sourceType":"script"}