{
    "sourceFile": "src/components/email/emailPreview.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1713876156350,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1713876156350,
            "name": "Commit-0",
            "content": "// src/PreviewEmail.js\nimport React, { useState, useEffect } from \"react\";\nimport { /*GetPreviewEmail*/ GetPreviewAttchmentEmail } from \"../../api/api\";\nimport Loader from \"../common/loader\";\n// import { FileViewer } from \"react-file-viewer\";\n// import { ToastContainer } from \"react-toastify\";\n// import AdminSidebar from \"../admin/sidebar\";\n// import AdminHeader from \"../admin/header\";\nimport { /*useNavigate,*/ Link } from \"react-router-dom\";\nimport { AiOutlineDownload } from \"react-icons/ai\";\nimport ReplyEmailForm from \"./ReplyEmailForm\";\nconst PreviewEmail = ({ id, emailType, singleEmailData }) => {\n  /* states */\n  let [apiCall, setApiCall] = useState(false);\n  let [isLoading, setIsLoading] = useState(true);\n  const [emailData, setemailData] = useState([]);\n  const [showReplyForm, setShowReplyForm] = useState(false);\n\n  const toggleReplyFormClick = () => {\n    setShowReplyForm(!showReplyForm);\n  };\n  /* Function to get Employee visa data */\n  const EmailData = async () => {\n    setIsLoading(true);\n    try {\n      const Res = await GetPreviewAttchmentEmail(emailType, id);\n      if (\n        // Res.messsage === \"No data found\" ||\n        // Res.status === \"0\" ||\n        // Res.status === 0 ||\n        Res.data.value === undefined ||\n        Res.data.value.length === 0 // && JSON.parse(Res.data)[0])\n      ) {\n        setemailData([]);\n        setIsLoading(false);\n      } else {\n        setemailData(Res.data.value);\n        // setTotalData(Res.data.total_rows);\n        setIsLoading(false);\n      }\n    } catch (err) {\n      console.log(err);\n      setIsLoading(false);\n      setemailData([]);\n    }\n  };\n\n  /*Render function to get the employee data*/\n  useEffect(() => {\n    EmailData();\n    if (apiCall === true) {\n      setApiCall(false);\n    }\n    // eslint-disable-next-line\n  }, [apiCall, id]);\n\n  /*Function to decode the email subject */\n  function decodeEmailSubject(encodedSubject) {\n    if (!encodedSubject) {\n      return \"\";\n    } else {\n      return decodeURIComponent(\n        encodedSubject\n          .replace(/=\\?UTF-8\\?Q\\?/g, \"\")\n          .replace(/\\?=/g, \"\")\n          .replace(/=([0-9A-F]{2})/g, (_, p1) =>\n            String.fromCharCode(parseInt(p1, 16))\n          )\n      );\n    }\n  }\n  /*Funcion to open pdf n new window */\n  // const openPDFInNewTab = (base64PDFData) => {\n  //   const dataUri = `data:application/pdf;base64,${base64PDFData}`;\n  //   const newWindow = window.open();\n  //   newWindow.document.write(\n  //     `<iframe src=\"${dataUri}\" style=\"width:100%;height:100%;\" frameborder=\"0\"></iframe>`\n  //   );\n  // };\n\n  // const openBase64HtmlInNewWindow = (base64Html) => {\n  // const decodedHtml = atob(base64Html);\n  // const newWindow = window.open(\"\", \"_blank\");\n  // if (newWindow) {\n  //   newWindow.document.write(decodedHtml);\n  //   newWindow.document.close();\n  // }\n  // };\n  return (\n    /*---- Email preview Page ----*/\n    <div>\n      {isLoading ? (\n        <Loader />\n      ) : singleEmailData === \"\" ? (\n        <div className=\"gmail-preview-container \">\n          <div className=\"email-content\">\n            <div className=\"email-header\">No Email found</div>\n          </div>\n        </div>\n      ) : (\n        <div className=\"gmail-preview-container \">\n          <div className=\"email-content\">\n            <div className=\"email-header\">\n              <p className=\"px-5 py-3 border-bottom\">\n                <b className=\"font-size-2\">FROM:</b>{\" \"}\n                {singleEmailData.sender.emailAddress.address}\n              </p>\n              <p className=\"px-5 py-3 border-bottom\">\n                <b className=\"font-size-2\">TO:</b>{\" \"}\n                {singleEmailData.toRecipients[0].emailAddress.address}\n              </p>\n              <p className=\"font-size-3 font-weight-bold px-5 py-3 border-bottom\">\n                <b className=\"font-size-2\">SUBJECT:</b>{\" \"}\n                {decodeEmailSubject(singleEmailData.subject)}\n              </p>\n            </div>\n            <div className=\"email-body text-break px-5 py-3\">\n              {singleEmailData.body.content && (\n                <div\n                  dangerouslySetInnerHTML={{\n                    __html: singleEmailData.body.content,\n                  }}\n                />\n              )}\n              <div className=\"attachments py-3 d-flex flex-wrap\">\n                {/* {emailData &&\n                emailData.map((item, index) => (\n                  <div\n                    key={index}\n                    className=\"col align-items-center p-3 m-3 rounded shadow bg-white position-relative htmlFileCls\"\n                  >\n                    {item.name && (\n                      <FileViewer\n                        fileType={item.name.split(\".\")[1]}\n                        filePath={`data:${item.contentType};base64,${item.contentBytes}`}\n                        errorComponent={() => <div>Error loading document</div>}\n                        onError={(e) => console.error(\"Error occurred:\", e)}\n                      />\n                    )}\n                  </div>\n                ))} */}\n                {emailData.length === 0\n                  ? null\n                  : (emailData || []).map((item, index) => {\n                    let iconSrc = \"\";\n                    let title = \"\";\n                    if (\n                      item.contentType === \"APPLICATION/PDF\" ||\n                      item.contentType === \"application/pdf\"\n                    ) {\n                      iconSrc =\n                        \"https://ssl.gstatic.com/docs/doclist/images/mediatype/icon_3_pdf_x16.png\";\n                      title = item.name;\n                    } else if (\n                      item.contentType === \"TEXT/HTML\" ||\n                      item.contentType === \"text/plain\" ||\n                      item.contentType === \"text/html\"\n                    ) {\n                      iconSrc =\n                        \"//ssl.gstatic.com/docs/doclist/images/mediatype/icon_1_text_x16.png\";\n                      title = item.name;\n                    } else if (\n                      item.contentType.startsWith(\"IMAGE/\") ||\n                      item.contentType.startsWith(\"image/\")\n                    ) {\n\n                      iconSrc = `data:${item.contentType};base64,${item.contentBytes}`;\n                      title = item.name;\n                    } else if (\n                      item.contentType ===\n                      \"APPLICATION/VND.OPENXMLFORMATS-OFFICEDOCUMENT.WORDPROCESSINGML.DOCUMENT\" ||\n                      item.contentType ===\n                      \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n                    ) {\n                      iconSrc =\n                        \"https://e7.pngegg.com/pngimages/18/655/png-clipart-computer-icons-microsoft-word-document-file-format-word-icon-blue-angle.png\";\n                      title = item.name;\n                    } else {\n                      iconSrc =\n                        \"https://icons.iconarchive.com/icons/thehoth/seo/256/seo-web-code-icon.png\";\n                      title = item.name;\n                    }\n\n                    return (\n                      <div\n                        key={index}\n                        className=\"align-items-center mr-3 mb-3 rounded border bg-white position-relative htmlFileCls text-center p-2\"\n                        title={item.name}\n                      >\n                        <Link\n                        // onClick={() =>\n                        //   openBase64FileInNewWindow(item.data, item.contentType)\n                        // }\n                        >\n                          <img\n                            src={iconSrc}\n                            alt={title}\n                            title={title}\n                            width={45}\n                            height={45}\n                            style={{ zIndex: \"1\" }}\n                          />\n                          <div>\n                            <small\n                              className=\"d-inline-block text-truncate text-decoration-none text-dark\"\n                              style={{ maxWidth: \"100%\" }}\n                            >\n                              {item.name}\n                            </small>\n                          </div>\n                        </Link>\n                        <div className=\"download-icon\">\n                          <Link\n                            to={`data:${item.contentType};base64,${item.contentBytes}`}\n                            download={item.name}\n                            className=\"text-dark\"\n                          >\n                            <AiOutlineDownload />\n                          </Link>\n                        </div>\n                      </div>\n                    );\n                  })}\n              </div>\n\n\n              {/* Render form conditionally */}\n              {showReplyForm ? (\n                <>\n                  <ReplyEmailForm\n                    mesId={id}\n                    emailType={emailType}\n                    setShowReplyForm={setShowReplyForm}\n                    setApiCall={setApiCall}\n                    toggleReplyFormClick={toggleReplyFormClick}\n                  />\n                </>\n              ) : <>\n                {/* Add button to toggle form */}\n                <button className=\"btn btn-primary\" onClick={toggleReplyFormClick}>\n                  Add Reply\n                </button>\n              </>}\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PreviewEmail;\n"
        }
    ]
}